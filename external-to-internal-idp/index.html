<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>External to Internal IdP Initiated Login on RH-SSO - Everyday Linux</title>
<meta name="author" content="Everyday Linux">
<meta name="description" content="Examples of working solutions in everyday Linux.">

<meta name="generator" content="Hugo 0.80.0" />


<link href="//fonts.googleapis.com/css?family=Roboto:300" rel="stylesheet">
<link rel="stylesheet" href='/assets/css/main.6c6783c882af.css'>


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/img/apple-touch-icon.png">
<link rel="shortcut icon" href="/assets/img/favicon.ico">


<link href="/posts/index.xml" rel="alternate" type="application/rss+xml" title="Everyday Linux" />
<link href="/posts/index.xml" rel="feed" type="application/rss+xml" title="Everyday Linux" />

<meta property="og:title" content="External to Internal IdP Initiated Login on RH-SSO" />
<meta property="og:description" content="External to Internal IdP Initiated Login on RH-SSO Install the Internal RH-SSO Download the zip install package from access.redhat.com.
   rh-sso-7.5.0-server-dist.zip
  rh-sso-7.5.0-saml-eap7-adapter-dist.zip
   Unzip an installation for your internal IdP.
 $ unzip rh-sso-7.5.0-server-dist.zip -d internal   Install client adapter for SAML example application on internal RH-SSO
 $ unzip -o rh-sso-7.5.0-saml-eap7-adapter-dist.zip -d internal/rh-sso-7.5/ $ ./internal/rh-sso-7.5/bin/jboss-cli.sh --file=./internal/rh-sso-7.5/bin/adapter-elytron-install-saml-offline.cli   Install client adapter for OIDC example application on internal RH-SSO" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://briantward.github.io/external-to-internal-idp/" />
<meta property="article:published_time" content="2022-02-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-02-03T00:00:00+00:00" />


<meta itemprop="name" content="External to Internal IdP Initiated Login on RH-SSO">
<meta itemprop="description" content="External to Internal IdP Initiated Login on RH-SSO Install the Internal RH-SSO Download the zip install package from access.redhat.com.
   rh-sso-7.5.0-server-dist.zip
  rh-sso-7.5.0-saml-eap7-adapter-dist.zip
   Unzip an installation for your internal IdP.
 $ unzip rh-sso-7.5.0-server-dist.zip -d internal   Install client adapter for SAML example application on internal RH-SSO
 $ unzip -o rh-sso-7.5.0-saml-eap7-adapter-dist.zip -d internal/rh-sso-7.5/ $ ./internal/rh-sso-7.5/bin/jboss-cli.sh --file=./internal/rh-sso-7.5/bin/adapter-elytron-install-saml-offline.cli   Install client adapter for OIDC example application on internal RH-SSO">
<meta itemprop="datePublished" content="2022-02-03T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-02-03T00:00:00+00:00" />
<meta itemprop="wordCount" content="405">



<meta itemprop="keywords" content="keycloak," />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="External to Internal IdP Initiated Login on RH-SSO"/>
<meta name="twitter:description" content="External to Internal IdP Initiated Login on RH-SSO Install the Internal RH-SSO Download the zip install package from access.redhat.com.
   rh-sso-7.5.0-server-dist.zip
  rh-sso-7.5.0-saml-eap7-adapter-dist.zip
   Unzip an installation for your internal IdP.
 $ unzip rh-sso-7.5.0-server-dist.zip -d internal   Install client adapter for SAML example application on internal RH-SSO
 $ unzip -o rh-sso-7.5.0-saml-eap7-adapter-dist.zip -d internal/rh-sso-7.5/ $ ./internal/rh-sso-7.5/bin/jboss-cli.sh --file=./internal/rh-sso-7.5/bin/adapter-elytron-install-saml-offline.cli   Install client adapter for OIDC example application on internal RH-SSO"/>


  </head>
  <body>
    <nav>
  <div class="title">
    
      <a href="/" title="Homepage">
        Everyday Linux
      </a>
    
  </div>
  <div class="nav">
    
      <a href="/" title="Homepage">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
          <polyline points="9 22 9 12 15 12 15 22" />
        </svg>
      </a>
    
    <a href="/posts/index.xml" title="RSS">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="rss"
      >
        <path d="M4 11a9 9 0 0 1 9 9" />
        <path d="M4 4a16 16 0 0 1 16 16" />
        <circle cx="5" cy="19" r="1" />
      </svg>
    </a>
  </div>
</nav>

    <main>
      
  <article>
    <header>
      <p>
        <time datetime="2022-02-03 12:00">2022-02-03</time> &bull;
          
            
            <a href="/categories/sso">SSO</a>
          
            , 
            <a href="/categories/linux">LINUX</a>
          </p>
      <h1>External to Internal IdP Initiated Login on RH-SSO</h1>
      <p>
        
          
            
            <a href="/tags/keycloak">
              <span class="hash">#</span>keycloak</a>
          
        
      </p>
    </header>
    <section>
      
<div class="sect1">
<h2 id="_external_to_internal_idp_initiated_login_on_rh_sso">External to Internal IdP Initiated Login on RH-SSO</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_install_the_internal_rh_sso">Install the Internal RH-SSO</h3>
<div class="paragraph">
<p>Download the zip install package from access.redhat.com.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>rh-sso-7.5.0-server-dist.zip</p>
</li>
<li>
<p>rh-sso-7.5.0-saml-eap7-adapter-dist.zip</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unzip an installation for your internal IdP.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ unzip rh-sso-7.5.0-server-dist.zip -d internal</pre>
</div>
</div>
<div class="paragraph">
<p>Install client adapter for SAML example application on internal RH-SSO</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ unzip -o rh-sso-7.5.0-saml-eap7-adapter-dist.zip -d internal/rh-sso-7.5/
$ ./internal/rh-sso-7.5/bin/jboss-cli.sh --file=./internal/rh-sso-7.5/bin/adapter-elytron-install-saml-offline.cli</pre>
</div>
</div>
<div class="paragraph">
<p>Install client adapter for OIDC example application on internal RH-SSO</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ unzip -o rh-sso-7.5.0-eap7-adapter-dist.zip -d internal/rh-sso-7.5/
$ ./internal/rh-sso-7.5/bin/jboss-cli.sh --file=./internal/rh-sso-7.5/bin/adapter-elytron-install-offline.cli</pre>
</div>
</div>
<div class="paragraph">
<p>Create admin user</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ./internal/rh-sso-7.5/bin/add-user-keycloak.sh -u admin -p admin123</pre>
</div>
</div>
<div class="paragraph">
<p>Run Server on default ports</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ./internal/rh-sso-7.5/bin/standalone.sh</pre>
</div>
</div>
<div class="paragraph">
<p>Download Keycloak project for example applications.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ git clone https://github.com/keycloak/keycloak.git</pre>
</div>
</div>
<div class="paragraph">
<p>Checkout clostest version match of Keycloak to RH-SSO 7.5</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cd keycloak &amp;&amp; git checkout 15.0.2</pre>
</div>
</div>
<div class="paragraph">
<p>Import POC example realm with user, role, and client adapter</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ../internal/rh-sso-7.5/bin/kcadm.sh config credentials --server http://localhost:8080/auth --realm master --user admin --password admin123
$ ../internal/rh-sso-7.5/bin/kcadm.sh create realms -f ./examples/saml/testsaml.json
$ cd examples/saml
$ mvn clean install wildfly:deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Login to the web application at <code><a href="http://localhost:8080/employee-sig/" class="bare">http://localhost:8080/employee-sig/</a></code> with user <code>bburke</code> and password <code>password</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_install_the_external_rh_sso">Install the External RH-SSO</h3>
<div class="paragraph">
<p>Unzip an installation for your external IdP.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ unzip rh-sso-7.5.0-server-dist.zip -d external</pre>
</div>
</div>
<div class="paragraph">
<p>Update /etc/hosts for a hostname for your external IdP to separate your cookie sessions (RH-SSO will be confused if your hostname is the same even if you are running on different ports).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ head -1 /etc/hosts
127.0.0.1 localhost localhost.localdomain rh-sso-external</pre>
</div>
</div>
<div class="paragraph">
<p>Create admin user</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ./external/rh-sso-7.5/bin/add-user-keycloak.sh -u admin -p admin123</pre>
</div>
</div>
<div class="paragraph">
<p>Run Server on different ports</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ./external/rh-sso-7.5/bin/standalone.sh -Djboss.socket.binding.port-offset=1000</pre>
</div>
</div>
<div class="paragraph">
<p>Create a realm on the external IdP.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ../external/rh-sso-7.5/bin/kcadm.sh config credentials --server http://rh-sso-external:9080/auth --realm master --user admin --password admin123
$ ./external/rh-sso-7.5/bin/kcadm.sh create realms -s realm=external-idp-realm -s enabled=true</pre>
</div>
</div>
<div class="paragraph">
<p>-a <a href="http://rh-sso-external:9080/auth/admin" class="bare">http://rh-sso-external:9080/auth/admin</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_install_federated_broker">Install Federated Broker</h3>
<div class="paragraph">
<p>Create a custom Authentication flow for first broker login to skip the typical user profile check</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ./internal/rh-sso-7.5/bin/kcadm.sh create authentication/flows -r saml-demo -i -f broker-login-flow.json</pre>
</div>
</div>
<div class="paragraph">
<p>Grab the IDP metadata from the external RH-SSO SAML descriptor URL</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ./get_idp_metadata.sh --output external-metadata.json external-provider-url.json</pre>
</div>
</div>
<div class="paragraph">
<p>Merge the IDP metadata into the IDP configuration for RH-SSO</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ jq &#39;.config = input&#39; rh-sso-external-idp.json external-metadata.json &gt; rh-sso-external-idp-merged.json</pre>
</div>
</div>
<div class="paragraph">
<p>Install federated IDP configuration in internal RH-SSO</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ./internal/rh-sso-7.5/bin/kcadm.sh create identity-provider/instances -r saml-demo -i -f rh-sso-external-idp-merged.json</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install_client_adapter_for_internal_rh_sso_in_the_external_rh_sso">Install client adapter for internal RH-SSO in the external RH-SSO</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Get metadata from a remote server endpoint</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ./get_sp_metadata.sh --output internal-client.json</pre>
</div>
</div>
<div class="paragraph">
<p>Or get metadata from a file</p>
</div>
<div class="paragraph">
<p>Merge the metadata into a client object for the RH-SSO API.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ jq &#39;.attributes = input&#39; internal-client-on-external.json internal-client.json &gt; internal-client-on-external-merged.json</pre>
</div>
</div>
<div class="paragraph">
<p>Update the attributes with a few required changes and additions.</p>
</div>
<div class="paragraph">
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/securing_applications_and_services_guide/index#jboss_adapter_installation" class="bare">https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/securing_applications_and_services_guide/index#jboss_adapter_installation</a></p>
</div>
<div class="paragraph">
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_administration_guide/index" class="bare">https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_administration_guide/index</a></p>
</div>
<div class="paragraph">
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_administration_guide/index#identity_broker_saml_sp_descriptor" class="bare">https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_administration_guide/index#identity_broker_saml_sp_descriptor</a></p>
</div>
<div class="paragraph">
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_administration_guide/index#assembly-exporting-importing_server_administration_guide" class="bare">https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_administration_guide/index#assembly-exporting-importing_server_administration_guide</a></p>
</div>
<div class="paragraph">
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_installation_and_configuration_guide/index#crossdc-mode" class="bare">https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.5/html-single/server_installation_and_configuration_guide/index#crossdc-mode</a></p>
</div>
</div>
</div>
</section>
    <footer>
      
      
    </footer>
  </article>

    </main>
    <footer>
  <div class="powered-by">
    Powered by <a href="https://gohugo.io" title="A Fast and Flexible Website Generator">Hugo</a> &amp; <a href="https://github.com/eshlox/simplicity" title="Hugo theme">Simplicity</a>.
  </div>
  <div class="copyright">
    &copy; 2023 Everyday Linux. <a href="http://creativecommons.org/licenses/by-sa/4.0/">Some Rights Reserved</a>.
  </div>
</footer>

    <script src="/assets/js/main.28b0c18ba028.js"></script>
    
    
  </body>
</html>

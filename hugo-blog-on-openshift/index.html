<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hugo Blog on OpenShift - Everyday Linux</title>
<meta name="author" content="Everyday Linux">
<meta name="description" content="Examples of working solutions in everyday Linux.">

<meta name="generator" content="Hugo 0.69.0" />


<link href="//fonts.googleapis.com/css?family=Roboto:300" rel="stylesheet">
<link rel="stylesheet" href='/assets/css/main.6c6783c882af.css'>


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/img/apple-touch-icon.png">
<link rel="shortcut icon" href="/assets/img/favicon.ico">


<link href="/posts/index.xml" rel="alternate" type="application/rss+xml" title="Everyday Linux" />
<link href="/posts/index.xml" rel="feed" type="application/rss+xml" title="Everyday Linux" />

<meta property="og:title" content="Hugo Blog on OpenShift" />
<meta property="og:description" content="Create a Dockerfile that adds all the dependencies your environment needs. A lot of the work is in this Dockerfile. I used asciidocs, so I needed an implementation of either asciidoc or asciidoctor, the two options that Hugo provides integration with. I chose asciidoctor.
   $ cat Dockerfile FROM centos:centos7 COPY . /opt/blog RUN cd /opt \ &amp;&amp; curl -O -J -L https://github.com/gohugoio/hugo/releases/download/v0.40.3/hugo_0.40.3_Linux-64bit.tar.gz \ &amp;&amp; tar -xf hugo_0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://briantward.github.io/hugo-blog-on-openshift/" />
<meta property="article:published_time" content="2018-05-11T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-05-11T00:00:00+00:00" />


<meta itemprop="name" content="Hugo Blog on OpenShift">
<meta itemprop="description" content="Create a Dockerfile that adds all the dependencies your environment needs. A lot of the work is in this Dockerfile. I used asciidocs, so I needed an implementation of either asciidoc or asciidoctor, the two options that Hugo provides integration with. I chose asciidoctor.
   $ cat Dockerfile FROM centos:centos7 COPY . /opt/blog RUN cd /opt \ &amp;&amp; curl -O -J -L https://github.com/gohugoio/hugo/releases/download/v0.40.3/hugo_0.40.3_Linux-64bit.tar.gz \ &amp;&amp; tar -xf hugo_0.">
<meta itemprop="datePublished" content="2018-05-11T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-05-11T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="403">



<meta itemprop="keywords" content="go,hugo,blog,asciidoc,asciidoctor," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Hugo Blog on OpenShift"/>
<meta name="twitter:description" content="Create a Dockerfile that adds all the dependencies your environment needs. A lot of the work is in this Dockerfile. I used asciidocs, so I needed an implementation of either asciidoc or asciidoctor, the two options that Hugo provides integration with. I chose asciidoctor.
   $ cat Dockerfile FROM centos:centos7 COPY . /opt/blog RUN cd /opt \ &amp;&amp; curl -O -J -L https://github.com/gohugoio/hugo/releases/download/v0.40.3/hugo_0.40.3_Linux-64bit.tar.gz \ &amp;&amp; tar -xf hugo_0."/>


  </head>
  <body>
    <nav>
  <div class="title">
    
      <a href="/" title="Homepage">
        Everyday Linux
      </a>
    
  </div>
  <div class="nav">
    
      <a href="/" title="Homepage">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
          <polyline points="9 22 9 12 15 12 15 22" />
        </svg>
      </a>
    
    <a href="/posts/index.xml" title="RSS">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="rss"
      >
        <path d="M4 11a9 9 0 0 1 9 9" />
        <path d="M4 4a16 16 0 0 1 16 16" />
        <circle cx="5" cy="19" r="1" />
      </svg>
    </a>
  </div>
</nav>

    <main>
      
  <article>
    <header>
      <p>
        <time datetime="2018-05-11 12:00">2018-05-11</time> &bull;
          
            
            <a href="/categories/openshift">OPENSHIFT</a>
          </p>
      <h1>Hugo Blog on OpenShift</h1>
      <p>
        
          
            
            <a href="/tags/go">
              <span class="hash">#</span>go</a>
          
            , 
            <a href="/tags/hugo">
              <span class="hash">#</span>hugo</a>
          
            , 
            <a href="/tags/blog">
              <span class="hash">#</span>blog</a>
          
            , 
            <a href="/tags/asciidoc">
              <span class="hash">#</span>asciidoc</a>
          
            , 
            <a href="/tags/asciidoctor">
              <span class="hash">#</span>asciidoctor</a>
          
        
      </p>
    </header>
    <section>
      
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a Dockerfile that adds all the dependencies your environment needs.  A lot of the work is in this Dockerfile.
I used asciidocs, so I needed an implementation of
either asciidoc or asciidoctor, the two options that Hugo provides integration with.  I chose asciidoctor.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ cat Dockerfile
FROM centos:centos7

COPY . /opt/blog

RUN cd /opt \
  &amp;&amp; curl -O -J -L https://github.com/gohugoio/hugo/releases/download/v0.40.3/hugo_0.40.3_Linux-64bit.tar.gz \
  &amp;&amp; tar -xf hugo_0.40.3_Linux-64bit.tar.gz \
  &amp;&amp; rm hugo_0.40.3_Linux-64bit.tar.gz \
  &amp;&amp; yum -y install ruby \
  &amp;&amp; yum clean all \
  &amp;&amp; rm -rf /var/cache/yum \
  &amp;&amp; gem install asciidoctor --no-user-install

EXPOSE 1313

WORKDIR /opt/blog

CMD ["/opt/hugo","server","--bind","0.0.0.0"]</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a project in openshift if needed.</p>
<div class="literalblock">
<div class="content">
<pre>$ oc new-project my-blog</pre>
</div>
</div>
</li>
<li>
<p>Provide authorization to build containers using root access, because we are building this image from the upstream
centos distribution.  You might have to request this from your system admin if
you do not have access to execute this command. By default, there are three <code>sa</code> or <code>serviceaccounts</code> in each project:
<code>builder</code>, <code>deployer</code>, and <code>default</code>.  You will only need root to build the image, but it can deploy and run as anyone.
This is better security practice.  Best security practice would be to derive this image from a secured image on Red Hat&#8217;s
repository.  Perhaps we&#8217;ll do that later.</p>
<div class="literalblock">
<div class="content">
<pre>$ oc adm policy add-scc-to-user anyuid -z builder -n my-blog</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>See notes here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://blog.openshift.com/getting-any-docker-image-running-in-your-own-openshift-cluster/" class="bare">https://blog.openshift.com/getting-any-docker-image-running-in-your-own-openshift-cluster/</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/3.7/admin_guide/manage_scc.html#enable-images-to-run-with-user-in-the-dockerfile" class="bare">https://docs.openshift.com/container-platform/3.7/admin_guide/manage_scc.html#enable-images-to-run-with-user-in-the-dockerfile</a></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new blank build.  You can get more How-To details here: <a href="https://docs.openshift.com/container-platform/3.7/dev_guide/dev_tutorials/binary_builds.html" class="bare">https://docs.openshift.com/container-platform/3.7/dev_guide/dev_tutorials/binary_builds.html</a></p>
<div class="literalblock">
<div class="content">
<pre>$ oc new-build --strategy docker --binary --docker-image centos:centos7 --name my-new-blog</pre>
</div>
</div>
</li>
<li>
<p>Start the Docker build from the directory.</p>
<div class="literalblock">
<div class="content">
<pre>$ oc start-build my-new-blog --from-dir . --follow</pre>
</div>
</div>
</li>
<li>
<p>Create a new app deployment based on your image.</p>
<div class="literalblock">
<div class="content">
<pre>$ oc new-app my-new-blog</pre>
</div>
</div>
</li>
<li>
<p>Expose the route externally.</p>
<div class="literalblock">
<div class="content">
<pre>$ oc expose svc/my-new-blog --hostname btw-blog.apps.example.com</pre>
</div>
</div>
</li>
<li>
<p>Export your work as a template to rebuild easily.</p>
<div class="literalblock">
<div class="content">
<pre>$ oc export all --as-template=btw-blog-template &gt; my-blog-template-template.yaml</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>How build from GitHub:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate a new build config</p>
<div class="literalblock">
<div class="content">
<pre>$ oc new-build --strategy docker https://github.com/briantward/blog --name btw-blog-blue</pre>
</div>
</div>
</li>
<li>
<p>Create a new deployment from this build config</p>
<div class="literalblock">
<div class="content">
<pre>$ oc new-app btw-blog-blue</pre>
</div>
</div>
</li>
<li>
<p>Edit your route to point to the new service</p>
<div class="literalblock">
<div class="content">
<pre>$ oc edit route btw-blog</pre>
</div>
</div>
</li>
<li>
<p>Make changes, commit to GitHub, then start a new build from your latest changes:</p>
<div class="literalblock">
<div class="content">
<pre>$ oc start-build btw-blog-blue</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Update for trigger from GitHub. Find URL from buildConfig: "Webhook GitHub:	URL: ".  Add this URL to your WebHook in GitHub and make sure to choose content
type "application/json".  It defaults to "application/x-www-form-urlencoded" and OpenShift doesn&#8217;t like that format.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc describe bc/btw-blog-blue</pre>
</div>
</div>
</section>
    <footer>
      
      
    </footer>
  </article>

    </main>
    <footer>
  <div class="powered-by">
    Powered by <a href="https://gohugo.io" title="A Fast and Flexible Website Generator">Hugo</a> &amp; <a href="https://github.com/eshlox/simplicity" title="Hugo theme">Simplicity</a>.
  </div>
  <div class="copyright">
    &copy; 2021 Everyday Linux. <a href="http://creativecommons.org/licenses/by-sa/4.0/">Some Rights Reserved</a>.
  </div>
</footer>

    <script src="/assets/js/main.28b0c18ba028.js"></script>
    
    
  </body>
</html>
